# 🚀 LINE @ 提醒系統 - 快速入門

## 📖 5分鐘了解系統

### 這個系統做什麼？
- 自動監控 LINE 群組中的 @ 提及
- 記錄誰被提及了、什麼時候、在什麼群組
- 提供網頁介面查看統計資料

### 系統運作流程
```
用戶在 LINE 群組輸入 "@小明 請幫忙"
    ↓
系統自動偵測到 @ 符號
    ↓
提取使用者名稱 "小明"
    ↓
儲存到資料庫
    ↓
在網頁上顯示統計資料
```

## 🛠️ 核心檔案說明

### 1. `app_simple.py` - 主要程式
**作用**: 處理所有邏輯
- 接收 LINE 訊息
- 解析 @ 提及
- 儲存資料
- 提供 API

### 2. `templates/index.html` - 網頁介面
**作用**: 顯示統計資料
- 美觀的卡片式設計
- 自動更新資料
- 響應式設計（手機電腦都可用）

### 3. `requirements.txt` - 套件清單
**作用**: 列出需要的 Python 套件
```
Flask==2.3.3          # 網頁框架
python-dotenv==1.0.0  # 環境變數
requests==2.31.0      # HTTP 請求
```

## 🔍 重要程式碼解析

### 1. 偵測 @ 提及
```python
def parse_mentions(text, group_id):
    # 檢查訊息中是否有 @ 符號
    mention_patterns = [
        r'@(\w+)',              # @英文名稱
        r'@([\u4e00-\u9fff]+)', # @中文名稱
    ]
```

### 2. 儲存資料
```python
def save_mentions(mentioned_users, group_id, message):
    # 將提及記錄存入資料庫
    cursor.execute('''
        INSERT INTO mentioned_users 
        (user_name, group_id, message, mentioned_at)
        VALUES (?, ?, ?, ?)
    ''')
```

### 3. 提供統計資料
```python
@app.route("/api/statistics")
def get_statistics():
    # 計算總提及次數
    cursor.execute('SELECT COUNT(*) FROM mentioned_users')
    total_mentions = cursor.fetchone()[0]
    
    return jsonify({
        'total_mentions': total_mentions
    })
```

## 🚀 如何部署

### 步驟 1: 準備工作
```bash
# 安裝 Python 套件
pip install -r requirements.txt

# 設定 LINE Bot
cp env_example.txt .env
# 編輯 .env 檔案，填入您的 LINE Bot 設定
```

### 步驟 2: 本地測試
```bash
# 啟動應用程式
python start_app.py

# 開啟瀏覽器訪問
http://localhost:5000
```

### 步驟 3: 雲端部署
```bash
# 推送到 GitHub
git add .
git commit -m "Initial commit"
git push origin main

# 在 Render 上部署
# 1. 前往 render.com
# 2. 建立 Web Service
# 3. 連接 GitHub 倉庫
# 4. 設定環境變數
```

## 📊 資料庫結構

### 主要表格: `mentioned_users`
| 欄位 | 說明 | 範例 |
|------|------|------|
| `user_name` | 被提及的使用者名稱 | "小明" |
| `group_id` | LINE 群組 ID | "C1234567890" |
| `message` | 完整訊息內容 | "@小明 請幫忙處理這個問題" |
| `mentioned_at` | 提及時間 | "2024-01-01 10:30:00" |

## 🌐 API 端點

### 1. 統計資料
```
GET /api/statistics
```
**回應範例**:
```json
{
    "total_mentions": 25,
    "unique_users": 8,
    "group_count": 3,
    "top_users": [
        {"user_name": "小明", "count": 5}
    ]
}
```

### 2. 提及記錄
```
GET /api/mentioned-users
```
**回應範例**:
```json
[
    {
        "user_name": "小明",
        "group_id": "群組 A",
        "message": "@小明 請幫忙",
        "mentioned_at": "2024-01-01 10:30:00"
    }
]
```

## 🎨 自訂功能

### 1. 修改提及格式
如果要支援 `#標籤` 格式：
```python
mention_patterns = [
    r'@(\w+)',    # 現有格式
    r'#(\w+)',    # 新增格式
]
```

### 2. 添加新統計項目
```python
# 新增：本週提及次數
cursor.execute('''
    SELECT COUNT(*) FROM mentioned_users 
    WHERE mentioned_at >= DATE('now', '-7 days')
''')
weekly_mentions = cursor.fetchone()[0]
```

### 3. 修改網頁樣式
編輯 `templates/index.html`：
```css
.stats-card {
    background: #your-color;  /* 修改顏色 */
    border-radius: 10px;      /* 修改圓角 */
}
```

## 🐛 常見問題

### Q: LINE Bot 沒有回應？
**A**: 檢查 Webhook URL 是否正確設定

### Q: 網頁無法載入資料？
**A**: 檢查 API 端點是否正常運作

### Q: 部署失敗？
**A**: 檢查 `requirements.txt` 和環境變數設定

## 📚 學習資源

### 初學者建議學習順序：
1. **Python 基礎** - 變數、函數、迴圈
2. **Flask 框架** - 路由、模板、API
3. **資料庫操作** - SQL 查詢
4. **前端基礎** - HTML、CSS、JavaScript
5. **雲端部署** - Git、GitHub、Render

### 相關技術：
- **Flask**: Python 網頁框架
- **SQLite**: 輕量級資料庫
- **LINE Bot API**: LINE 機器人 API
- **Render**: 雲端部署平台

---

**開始您的程式學習之旅吧！** 🎉 